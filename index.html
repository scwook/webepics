<!DOCTYPE html>
<html lang="en">
<link rel="stylesheet" type="text/css" href="index.css">
<script src="widget.js"></script>

<body>
    <div style="margin:auto; position: relative; width:1920px; height:80px;">
        <div id="time-stamp"><span id="timestamp-date"></span><span id="timestamp-time"></span></div>
        <div id="raon-box">
            <svg>
                <circle class="raonLogo" cx="7.7854" cy="7.7854" r="7.7854" />
                <path class="raonLogo"
                    d="M275.5951,237.9206a14.4381,14.4381,0,1,0,14.2967,14.4365A14.3676,14.3676,0,0,0,275.5951,237.9206Zm0,23.2125a8.78,8.78,0,1,1,8.4931-8.776A8.6381,8.6381,0,0,1,275.5951,261.1331Z"
                    transform="translate(-183.5864 -232.9662)" />
                <rect class="raonLogo" x="56.9286" y="22.2218" width="14.5315" height="4.8127" />
                <path class="raonLogo"
                    d="M248.2542,246.69l-1.1207,2.8376-7.4978,16.9841h-6.2232l12.2847-26.9313a2.8321,2.8321,0,0,1,5.1564,0l12.2848,26.9313h-6.223l-7.498-16.9841-1.1208-2.8376Z"
                    transform="translate(-183.5864 -232.9662)" />
                <path class="raonLogo"
                    d="M298.3774,239.0425a2.8313,2.8313,0,0,0-5.0884,1.7091v25.76h5.6621V252.357l-.0282-4.2446h.0282l3.0654,4.2446,10.2483,13.3162a2.831,2.831,0,0,0,5.0882-1.7089v-25.76h-5.6621V252.357l.0282,4.2465h-.0282l-3.0654-4.2465Z"
                    transform="translate(-183.5864 -232.9662)" />
                <path class="raonLogo"
                    d="M222.4547,252.1667l5.0127,5.4524,7.65,8.8929h-7.5081l-11.1726-13.7666a1.2554,1.2554,0,0,1-.293-.8124,1.2734,1.2734,0,0,1,1.2739-1.2731h7.6439a3.68,3.68,0,1,0,0-7.36H191.3717a2.5479,2.5479,0,0,1,0-5.0957h34.2555a8.8478,8.8478,0,0,1,8.9178,8.7761,8.6837,8.6837,0,0,1-2.8308,6.4122,8.7967,8.7967,0,0,1-6.2992,2.15"
                    transform="translate(-183.5864 -232.9662)" />
            </svg>
        </div>
        <div id="accelerator-control">CS</div>
        <div id="widget-menu">
            <label class="wdigetItemContainer">
                <input type="radio" name="widget" value="type1-1" onclick="widgetSelect(this)">
                <span class="widgetSelectButton">
                    <svg width="60" height="60">
                        <rect class="widget" width="60" height="60" fill="green" />
                    </svg>
                </span>
            </label>
            <label class="wdigetItemContainer">
                <input type="radio" name="widget" value="type1-2" onclick="widgetSelect(this)">
                <span class="widgetSelectButton">
                    <svg width="80" height="80">
                        <rect class="widget" width="80" height="80" />
                    </svg>
                </span>
            </label>

        </div>
        <button type="button" onclick="modeChange()">Mode</button>
        <button id="createButton" type="button" onclick="createNewMonitor()">New</button>
    </div>

    <div class="body-box">
        <button class="slide-button" onclick="changePage(-1)">&#10094;</button>

        <div class="monitoring-body">
            <div id="monitoringContainer" class="monitoring-container">
                <!-- <div class="monitoring-item type1"></div> -->

            </div>
            <!-- Page 1 -->
            <!-- <div class="slide-page" style="display: block;">

            </div> -->
            <!-- Page 2 -->
            <!-- <div class="slide-page" style="display: none;">

            </div> -->
        </div>

        <button class="slide-button" onclick="changePage(1)">&#10095;</button>
    </div>

    <div id="widget-properties-container"></div>

</body>

<script>
    var isEditMode = false;

    window.onload = function () {

        // Page 1 

        // Page 2


    }

    function modeChange() {
        if (isEditMode) {
            monitoringMode();
            isEditMode = false;
            console.log("monitoring mode")
        }
        else {
            editMode();
            isEditMode = true;
            console.log("edit mode");
        }
    }

    function editMode() {
        var childContainerClass = document.getElementsByClassName("child-container");
        console.log(childContainerClass.length);
        for (let i = 0; i < childContainerClass.length; i++) {
            childContainerClass[i].addEventListener("click", function () { itemOnClick(this) });
            childContainerClass[i].addEventListener("mouseenter", function () { itemMouseEnter(this) });
            childContainerClass[i].addEventListener("mouseleave", function () { itemMouseLeave(this) });
            childContainerClass[i].style.borderWidth = "2px";

            childContainerClass[i].childNodes[0].addEventListener("click", function () { deleteMonitoring(this.parentNode) });
        }

        const subChildContainer2 = document.getElementsByClassName("subChild-container2");
        for (let i = 0; i < subChildContainer2.length; i++) {
            subChildContainer2[i].style.visibility = "visible";
        }

        document.getElementById("createButton").style.visibility = "visible";

    }

    function monitoringMode() {
        const childContainerClass = document.getElementsByClassName("child-container");
        for (let i = 0; i < childContainerClass.length; i++) {
            childContainerClass[i].replaceWith(childContainerClass[i].cloneNode(true));
            childContainerClass[i].style.borderWidth = "0px";
        }

        const subChildContainer2 = document.getElementsByClassName("subChild-container2");
        for (let i = 0; i < subChildContainer2.length; i++) {
            subChildContainer2[i].style.visibility = "hidden";
        }

        document.getElementById("createButton").style.visibility = "hidden";

        // var deleteButtonClass = document.getElementsByClassName("deleteButton");
        // for (let i = 0; i < deleteButtonClass.length; i++) {
        //     deleteButtonClass[i].style.visibility = "hidden";
        // }


    }

    function createNewMonitor() {
        var parentContainerID = document.getElementById("monitoringContainer"); // Flex Body
        const childContainer = document.createElement("div"); // Flex Item

        childContainer.classList.add("type1");
        childContainer.classList.add("child-container");
        childContainer.addEventListener("click", function () { itemOnClick(this) });
        childContainer.addEventListener("mouseenter", function () { itemMouseEnter(this) });
        childContainer.addEventListener("mouseleave", function () { itemMouseLeave(this) });
        childContainer.style.borderWidth = "2px";


        // subChild Container1 elements
        const subChildContainer1 = document.createElement("div");
        subChildContainer1.classList.add("subChild-container1");

        // subChild Container2 elements
        const subChildContainer2 = document.createElement("div");
        subChildContainer2.classList.add("subChild-container2");

        const deleteButton = document.createElement("button");
        deleteButton.classList.add('deleteButton');
        deleteButton.innerText = document.getElementsByClassName("child-container").length;
        deleteButton.addEventListener("click", function () { deleteMonitoring(childContainer) });

        subChildContainer2.appendChild(deleteButton);

        // 
        childContainer.appendChild(subChildContainer2);
        childContainer.appendChild(subChildContainer1);

        parentContainerID.appendChild(childContainer);
        // parentNodeID.appendChild(deleteButton);
    }


    function itemOnClick(id) {
        const childContainer = id.childNodes[1];
        if (childContainer.hasChildNodes()) {
            console.log("has child node");
            return;
        }

        const propertiesFormNode = document.createElement("form");
        propertiesFormNode.setAttribute("id", "widget-properties-form");

        const propertiesContainer = document.getElementById("widget-properties-container");
        propertiesContainer.appendChild(propertiesFormNode);

        propertiesContainer.style.display = "flex";

        console.log(propertiesContainer);

        const titleNode = document.createElement("div");
        titleNode.classList.add('widget-title');
        titleNode.innerText = "Title Text";

        let widgetMenu = document.getElementById("widget-menu");
        let selectedWidget = widgetMenu.querySelector("input[type=radio]:checked").value;

        switch (selectedWidget) {
            case "type1-1":
                // Text Update Widget        
                var valueNode = document.createElement("div");
                valueNode.classList.add('widget-value');
                valueNode.style.setProperty("--fontSize", "60px");
                valueNode.style.top = 80 + "px";
                valueNode.innerText = "Process Value";

                childContainer.appendChild(titleNode);
                childContainer.appendChild(valueNode);
                break;

            case "type1-2":
                // Type1-1 Widget : Line Doughnut
                var valueNode = document.createElement("div");
                valueNode.classList.add("widget-value");
                valueNode.style.setProperty("--fontSize", "30px");
                valueNode.style.top = 125 + "px";
                valueNode.innerText = "Value";

                const widgetHTML = doughnutChartSVG;
                const doughnutChartNode = document.createElement("div");
                doughnutChartNode.classList.add("widget-container");
                doughnutChartNode.innerHTML = widgetHTML;

                childContainer.appendChild(titleNode);
                childContainer.appendChild(doughnutChartNode);
                childContainer.appendChild(valueNode);

                const test1 = document.getElementById("test1");
                doughnutChartAnimation('test1', 50);

                break;
            
            default:

        }

        console.log("onclick");
    }

    function itemMouseEnter(id) {
        id.style.backgroundColor = "rgba(26,26,26,0.8)";

        // var widgetContainer = document.getElementById("container");
        // var selectedWidget = widgetContainer.querySelector("input[type=radio]:checked").value;

        // switch (selectedWidget) {
        //     case "first":
        //         id.style.backgroundColor = "red";
        //         break;
        //     case "second":
        //         id.style.backgroundColor = "green";
        //         break;
        //     default:
        //         id.style.backgroundColor = "#e94174";

        // }
    }

    function itemMouseLeave(id) {
        id.style.backgroundColor = "rgba(26,26,26,0.3)";
    }

    function deleteMonitoring(id) {
        var parentNode = document.getElementById("monitoringContainer");
        if (parentNode.hasChildNodes()) {
            parentNode.removeChild(id);
            console.log("delete");
        }

        event.stopPropagation();

        // const childNode = parentNode.querySelector("div");
        // parentNode.removeChild(childNode[0]);
    }

    function widgetSelect(id) {
        // let widgetMenu = document.getElementById("widget-menu");
        // let selectedWidget = widgetMenu.querySelector("input[type=radio]:checked");

        // console.log(selectedWidget);
        // let parentNode = selectedWidget.parentNode;
        // let widget = parentNode.querySelector(".aaa");

        // widget.setAttribute("fill", "blue");

        console.log("selected");
        // switch (selectedWidget) {
        //     case "first":
        //         id.style.backgroundColor = "red";
        //         break;
        //     case "second":
        //         id.style.backgroundColor = "green";
        //         break
        // }
    }

    document.addEventListener('visibilitychange', function () {
        if (document.hidden) {
            documentHidden = true;
            console.log('hide');
        } else {
            documentHidden = false;
            console.log('view');
        }
    });

    const chartMaxLength = Math.ceil(160 * Math.PI);
    function doughnutChartAnimation(chartID, chartValue) {

        let maxValue = 100;
        // let randomValue = Math.random() * maxValue;
        let value = chartValue;
        let valueToOffset = Math.floor(chartMaxLength - chartMaxLength / maxValue * value);

        let fgID = document.getElementById(chartID);
        let currentDashOffset = parseInt(fgID.style.strokeDashoffset);

        let sign = valueToOffset - currentDashOffset;

        let dir = 0;
        if (sign > 0) {
            dir = -1; // anitclockwise, increase offset value
        } else if (sign < 0) {
            dir = 1; // clockwise, decrease offset value
        }

        if (dir == 0) {
            return;
        }

        let duration = 2000;
        let interval = 10;
        let count = 0;
        let maxCount = Math.floor(duration / interval);
        let x1 = 0.0;
        let x2 = 1.0;
        let dx = Math.abs(x1 - x2) / maxCount;
        let x = 0.0;
        let y = 0;
        let y1 = (dir == 1) ? valueToOffset : currentDashOffset;
        let y2 = (dir == 1) ? currentDashOffset : valueToOffset;
        let a = Math.abs(currentDashOffset - valueToOffset);
        let b = y1;

        let id = setInterval(function () {

            switch (dir) {
                case 1:
                    y = a * Math.pow(2, -10 * x) + y1;
                    break;

                case -1:
                    y = a * (1 - Math.pow(2, -10 * x)) + y1;

                    break;

                default:
                    count = maxCount; // 
            }

            fgID.style.strokeDashoffset = Math.floor(y);

            x += dx;
            count += 1;

            if (count == maxCount) {
                clearInterval(id);
            }

        }, interval);
    }

</script>

</html>